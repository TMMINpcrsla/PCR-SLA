<template>
    <div class="container">
      <h1>Status PCR & SLA</h1>
      
      <div class="input-form">
        <div class="input-group">
          <label for="inputA">Doc Received Date</label>
          <input 
            type="text" 
            id="inputA" 
            v-model="formData.docReceivedDate" 
            @input="formatDateInput" 
            placeholder="YYYY-MM-DD" 
            maxlength="10"
          >
        </div>
        
        <div class="input-group">
          <label for="inputB">PCR/SLA Control No.</label>
          <input 
            type="text" 
            id="inputB" 
            v-model="formData.controlNo"
          >
        </div>
        
        <div class="input-group">
          <label for="inputC">Supplier Name</label>
          <select id="inputC" v-model="formData.supplierName">
            <option value="">Pilih opsi</option>
            <option v-for="supplier in suppliers" :key="supplier" :value="supplier">
              {{ supplier }}
            </option>
          </select>
        </div>
  
        <div class="input-group">
          <label for="inputD">Part Number</label>
          <input 
            type="text" 
            id="inputD" 
            v-model="formData.partNumber" 
            @input="formatPartNumberInput" 
            placeholder="12345-12345-12" 
            maxlength="14"
          >
        </div>
  
        <div class="input-group">
          <label for="inputE">Part Name</label>
          <input 
            type="text" 
            id="inputE" 
            v-model="formData.partName"
          >
        </div>
  
        <div class="input-group">
          <label for="inputF">Change Category</label>
          <select id="inputF" v-model="formData.changeCategory">
            <option value="">Pilih opsi</option>
            <option v-for="category in changeCategories" :key="category" :value="category">
              {{ category }}
            </option>
          </select>
        </div>
  
        <div class="input-group">
          <label for="inputG">Previous Process</label>
          <input 
            type="text" 
            id="inputG" 
            v-model="formData.previousProcess"
          >
        </div>
  
        <div class="input-group">
          <label for="inputH">New Process</label>
          <input 
            type="text" 
            id="inputH" 
            v-model="formData.newProcess"
          >
        </div>
        
        <button @click="saveData" class="submit-btn">Enter Data</button>
        
        <div :class="['status-message', status.type]" v-if="status.show">
          {{ status.message }}
        </div>
      </div>
      
      <p>Apabila ada kendala, segera sampaikan ke tim Quality Control</p>
      <a href="in.html" class="my-button">Kembali ke Home</a>
    </div>
  </template>
  
  <script>
  import { initializeApp } from 'firebase/app';
  import { getDatabase, ref, set } from 'firebase/database';
  
  export default {
    name: 'PcrSlaForm',
    data() {
      return {
        formData: {
          docReceivedDate: '',
          controlNo: '',
          supplierName: '',
          partNumber: '',
          partName: '',
          changeCategory: '',
          previousProcess: '',
          newProcess: ''
        },
        suppliers: [
          "AISAN NASMOCO INDUSTRI",
          "AISIN INDONESIA",
          "AISIN INDONESIA OTOMOTIF",
          "AOYAMA INDONESIA",
          "ART PISTON INDONESIA",
          "ASSB MALAYSIA",
          "ASTRA NIPPON GASKET INDONESIA",
          "AT INDONESIA",
          "AUTOMOTIVE FASTENERS AOYAMA INDONESIA",
          "CATALER",
          "DENSO INDONESIA CORPORATION (FAJAR)",
          "DIAMOND DELECTRIC INDONESIA",
          "FUKOKU TOKAI RUBBER",
          "FUTABA INDONESIA",
          "HITACHI",
          "ITOKIN",
          "METALART ASTRA INDONESIA",
          "NICHIAS SUNIJAYA",
          "NOK INDONESIA",
          "OTICS INDONESIA",
          "PAKAR TIRIKEN INDONESIA",
          "PARIN",
          "PATEC PRESISI ENGINEERING",
          "ROBERT BOSCH",
          "SARI TAKAGI ELOK PRODUK",
          "SIAM THAILAND MOTOR",
          "SUMIDEN SINTERED COMPONENT INDONESIA",
          "SUNCHIRIN INDUSTRI INDONESIA",
          "TAIHO NUSANTARA",
          "TB-INA",
          "TOYOTA BOSHOKU INDONESIA",
          "TPR SALES INDONESIA",
          "VELASTO INDONESIA",
          "YASUNAGA INDONESIA",
          "#NA"
        ],
        changeCategories: [
          "Add Supplier",
          "Capacity",
          "Change Supplier",
          "Cost",
          "Govt Regulation",
          "Localization",
          "Mfg/Storage Loc",
          "Productivity",
          "Quality",
          "Risk Mgmt",
          "Other"
        ],
        status: {
          show: false,
          message: '',
          type: ''
        },
        firebaseConfig: {
          apiKey: "AIzaSyDB31VI5CjfiLPwD5njBa2tVHz_UXipNH0",
          authDomain: "pcr-sla-28728.firebaseapp.com",
          databaseURL: "https://pcr-sla-28728-default-rtdb.firebaseio.com",
          projectId: "pcr-sla-28728",
          storageBucket: "pcr-sla-28728.firebasestorage.app",
          messagingSenderId: "738065802011",
          appId: "1:738065802011:web:28f865a4cb84a76f0a69be",
          measurementId: "G-NE5XL3LRJ8"
        }
      }
    },
    created() {
      // Initialize Firebase
      this.app = initializeApp(this.firebaseConfig);
      this.database = getDatabase(this.app);
    },
    methods: {
      formatDateInput() {
        let value = this.formData.docReceivedDate.replace(/[^\d]/g, '');
        
        if (value.length > 4) {
          value = value.substring(0, 4) + '-' + value.substring(4);
        }
        if (value.length > 7) {
          value = value.substring(0, 7) + '-' + value.substring(7);
        }
        
        this.formData.docReceivedDate = value.substring(0, 10);
      },
      formatPartNumberInput() {
        let value = this.formData.partNumber.toUpperCase();
        value = value.replace(/[^A-Z0-9-]/g, '');
        const valueWithoutHyphens = value.replace(/-/g, '');
        let formattedValue = valueWithoutHyphens;
  
        if (valueWithoutHyphens.length > 5) {
          formattedValue = valueWithoutHyphens.substring(0, 5) + '-' + valueWithoutHyphens.substring(5);
        }
        if (valueWithoutHyphens.length > 11) {
          formattedValue = formattedValue.substring(0, 11) + '-' + formattedValue.substring(11);
        }
        
        this.formData.partNumber = formattedValue.substring(0, 14);
      },
      saveData() {
        // Validate inputs
        if (!this.validateForm()) {
          return;
        }
  
        // Save to Firebase
        set(ref(this.database, this.formData.docReceivedDate), {
          B: this.formData.controlNo,
          C: this.formData.supplierName,
          D: this.formData.partNumber,
          E: this.formData.partName,
          F: this.formData.changeCategory,
          G: this.formData.previousProcess,
          H: this.formData.newProcess,
          status: 'New'
        })
        .then(() => {
          this.showStatus('Data berhasil disimpan!', 'success');
          this.resetForm();
        })
        .catch((error) => {
          this.showStatus('Error: ' + error.message, 'error');
        });
      },
      validateForm() {
        // Check all fields are filled
        for (const key in this.formData) {
          if (!this.formData[key]) {
            this.showStatus('Semua field harus diisi!', 'error');
            return false;
          }
        }
  
        // Validate date format
        const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
        if (!dateRegex.test(this.formData.docReceivedDate)) {
          this.showStatus('Format tanggal harus YYYY-MM-DD!', 'error');
          return false;
        }
  
        return true;
      },
      showStatus(message, type) {
        this.status = {
          show: true,
          message,
          type
        };
        
        setTimeout(() => {
          this.status.show = false;
        }, 3000);
      },
      resetForm() {
        this.formData = {
          docReceivedDate: '',
          controlNo: '',
          supplierName: '',
          partNumber: '',
          partName: '',
          changeCategory: '',
          previousProcess: '',
          newProcess: ''
        };
      }
    }
  }
  </script>
  
  <style scoped>
  .input-form {
    margin: 20px 0;
    padding: 20px;
    background-color: #f9f9f9;
    border-radius: 8px;
  }
  .input-group {
    margin-bottom: 15px;
  }
  .input-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    text-align: left;
    padding-left: 0;
  }
  .input-group input, .input-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
  }
  .submit-btn {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
  }
  .submit-btn:hover {
    background-color: #45a049;
  }
  .status-message {
    margin-top: 15px;
    padding: 10px;
    border-radius: 4px;
  }
  .success {
    background-color: #dff0d8;
    color: #3c763d;
  }
  .error {
    background-color: #f2dede;
    color: #a94442;
  }
  .container {
    padding-left: 20px;
  }
  </style>